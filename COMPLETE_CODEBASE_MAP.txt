THERAPYBRIDGE CODEBASE COMPLETE STRUCTURE MAP
==============================================

Generated: 2025-12-18
Project Type: Monorepo with 4 independent projects
Version Control: Git (main branch)

================================================================================
PROJECT OVERVIEW
================================================================================

TherapyBridge is a healthcare platform for therapy session management with the following components:

1. BACKEND (FastAPI/Python) - /backend
   - RESTful API with HIPAA-compliant security
   - PostgreSQL database (Neon)
   - AI note extraction service
   - Feature: 8 major features including authentication, goal tracking, exports

2. FRONTEND (Next.js/React/TypeScript) - /frontend
   - Next.js 16 + React 19 + Tailwind CSS
   - Therapist & patient dashboards
   - Session management UI
   - Error boundaries & dark mode support

3. AUDIO TRANSCRIPTION PIPELINE (Python) - /audio-transcription-pipeline
   - CPU & GPU pipelines
   - Whisper transcription
   - Speaker diarization (pyannote)
   - Therapist/client role labeling

4. SCRAPPING/DATA COLLECTION (Python) - /Scrapping
   - Web scraper for therapy resources
   - Upheal.com scraper implementation
   - Storage & logging utilities

5. THERAPYBRIDGE BACKEND (Alternative) - /therabridge-backend
   - Prompt system for AI
   - Template-based AI prompting

================================================================================
ROOT DIRECTORY STRUCTURE (/Users/newdldewdl/Global Domination 2/peerbridge proj)
================================================================================

.
├── .claude/                              # Claude Code configuration (monorepo level)
│   ├── CLAUDE.md                         # Project rules & organization
│   ├── ORCHESTRATION_SYSTEM_INDEX.md     # Meta-orchestration docs
│   ├── DYNAMIC_WAVE_ORCHESTRATION.md     # Parallel execution methodology
│   ├── META_ORCHESTRATION.md             # Child orchestrator spawning
│   ├── agents/cl/                        # Agent definitions
│   │   ├── parallel-orchestrator.md      # Main orchestration agent
│   │   ├── codebase-analyzer.md
│   │   ├── codebase-locator.md
│   │   ├── codebase-pattern-finder.md
│   │   ├── web-search-researcher.md
│   │   └── README.md
│   └── commands/cl/                      # Custom slash commands
│       ├── orchestrate.md
│       ├── commit.md
│       ├── iterate_plan.md
│       ├── describe_pr.md
│       ├── create_plan.md
│       ├── implement_plan.md
│       └── research_codebase.md
│
├── Project MDs/                          # Consolidated project documentation
│   └── TherapyBridge.md (459 lines)      # Master project documentation
│
├── .git/                                 # Git repository
├── .github/                              # GitHub configuration
├── .gitignore                            # Root gitignore
├── .python-version                       # Python 3.13
├── README.md                             # Root README
│
├── backend/                              # FastAPI Backend (STANDALONE)
├── frontend/                             # Next.js Frontend (STANDALONE)
├── audio-transcription-pipeline/         # Transcription Pipeline (STANDALONE)
├── Scrapping/                            # Web Scraper Project (STANDALONE)
├── therabridge-backend/                  # Alternative backend (LEGACY)
│
└── Documentation Files (Root-level):
    ├── GENERATORS_AND_HOOKS_ANALYSIS.md
    └── GENERATORS_SUMMARY.txt

================================================================================
1. BACKEND PROJECT (/backend)
================================================================================

PROJECT TYPE: FastAPI REST API with SQLAlchemy ORM
PYTHON VERSION: 3.13
DATABASE: PostgreSQL (Neon)
ASYNC: Yes (asyncio + asyncpg)
AUTH: JWT + Multi-Factor Authentication (TOTP)
DEPLOYMENT: Docker (Alpine/Lambda/Ubuntu)

ROOT FILES:
├── requirements.txt                      # 80+ dependencies (Python 3.13 compatible)
├── .env                                  # Environment configuration
├── .env.example                          # Configuration template
├── .gitignore                            # Backend-specific ignore rules
├── .python-version                       # Python 3.13
├── .coverage                             # Test coverage report
├── coverage.xml                          # Coverage XML
├── pytest.ini                            # Test configuration
├── alembic.ini                           # Database migration config
├── README.md (31KB)                      # Backend documentation
├── SECURITY.md (17KB)                    # HIPAA compliance & security
├── DEPLOYMENT_CHECKLIST.md               # Production deployment guide
├── FEATURE_8_TEST_REPORT.md              # Latest feature test results
│
├── Dockerfile.alpine                     # Alpine Linux container
├── Dockerfile.lambda                     # AWS Lambda deployment
├── Dockerfile.ubuntu                     # Ubuntu-based container
│
├── venv/                                 # Python virtual environment
├── .pytest_cache/                        # Test cache
├── htmlcov/                              # HTML coverage reports
├── uploads/audio/                        # Runtime audio uploads
├── exports/output/                       # Generated exports
│
├── alembic/                              # Database migrations framework
│   ├── alembic.ini
│   ├── env.py
│   ├── script.py.mako
│   └── versions/                         # 16 migration files
│       ├── 42ef48f739a4_add_authentication_schema.py
│       ├── 7cce0565853d_create_auth_tables.py
│       ├── 808b6192c57c_add_authentication_schema_and_missing_.py
│       ├── 4da5acd78939_add_treatment_plan_tables.py
│       ├── b2c3d4e5f6g7_add_missing_user_columns_and_junction.py (Feature 1)
│       ├── c3d4e5f6g7h8_add_analytics_tables.py
│       ├── d4e5f6g7h8i9_add_timeline_events_table.py
│       ├── d5e6f7g8h9i0_create_treatment_goals_table.py
│       ├── e4f5g6h7i8j9_add_export_tables.py
│       ├── e5f6g7h8i9j0_add_goal_tracking_tables.py
│       ├── f6g7h8i9j0k1_add_note_template_tables.py
│       ├── g7h8i9j0k1l2_add_security_compliance_tables.py
│       ├── h8i9j0k1l2m3_add_missing_feature6_indexes.py
│       └── i9j0k1l2m3n4_add_notification_read_field.py
│
└── app/                                  # Main FastAPI application

    ├── main.py                           # FastAPI app setup & route initialization
    ├── config.py                         # Configuration management
    ├── database.py                       # Database connection setup
    ├── logging_config.py                 # Structured logging configuration
    ├── scheduler.py                      # Background task scheduler
    ├── validators.py                     # Data validation utilities
    │
    ├── auth/                             # Authentication module
    │   ├── __init__.py
    │   ├── router.py                     # Auth endpoints (signup/login)
    │   ├── schemas.py                    # Pydantic schemas for auth
    │   ├── models.py                     # Auth models
    │   ├── config.py                     # Auth configuration
    │   ├── utils.py                      # Auth utilities
    │   └── dependencies.py               # FastAPI dependency injection
    │
    ├── middleware/                       # Request/response middleware
    │   ├── __init__.py
    │   ├── correlation_id.py             # Request tracing
    │   ├── audit.py                      # Audit logging
    │   ├── security_headers.py           # HIPAA security headers
    │   ├── rate_limit.py                 # Rate limiting
    │   ├── error_handler.py              # Global error handling
    │   └── test_error_handler.py         # Error handler tests
    │
    ├── security/                         # Security & compliance
    │   ├── __init__.py
    │   ├── mfa.py                        # Multi-factor authentication (TOTP)
    │   ├── encryption.py                 # Field-level encryption
    │   ├── emergency_access.py           # Emergency access protocols
    │   ├── session_manager.py            # Session lifecycle management
    │   └── consent.py                    # Consent tracking
    │
    ├── models/                           # Database & data models (10 files)
    │   ├── __init__.py
    │   ├── db_models.py (10KB)           # SQLAlchemy ORM models
    │   │   ├── User model (name, role, MFA, verification)
    │   │   ├── TherapySession model (renamed from Session)
    │   │   ├── TherapistPatient junction table
    │   │   ├── SessionNote model
    │   │   ├── Goal, GoalTracking models
    │   │   ├── TreatmentPlan, Intervention models
    │   │   ├── Assessment model
    │   │   └── More...
    │   ├── schemas.py (25KB)             # Request/response schemas
    │   ├── analytics_models.py           # Analytics aggregation models
    │   ├── goal_models.py                # Goal-specific models
    │   ├── security_models.py (11KB)     # MFA, audit, consent models
    │   ├── export_models.py (7KB)        # Export/reporting models
    │   ├── tracking_models.py (12KB)     # Goal tracking models
    │   ├── treatment_models.py (11KB)    # Treatment plan models
    │   ├── treatment_schemas.py (19KB)   # Treatment schemas
    │   └── data/                         # Seed data
    │
    ├── routers/                          # API endpoint routers (21 files, 400+ LOC each)
    │   ├── __init__.py
    │   ├── sessions.py (1246 LOC)        # Session CRUD, processing, transcription
    │   ├── patients.py                   # Patient management
    │   ├── goals.py (13KB)               # Goal CRUD & retrieval
    │   ├── goal_tracking.py (30KB)       # Goal tracking, milestones, notifications
    │   ├── notes.py                      # Session notes CRUD
    │   ├── templates.py                  # Note template management
    │   ├── treatment_plans.py (14KB)     # Treatment plan endpoints
    │   ├── interventions.py (8KB)        # Intervention tracking
    │   ├── assessments.py (8KB)          # Assessment endpoints
    │   ├── analytics.py (6KB)            # Analytics & dashboards
    │   ├── progress_reports.py           # Progress report generation
    │   ├── self_report.py (8KB)          # Patient self-reports
    │   ├── export.py (22KB)              # PDF/DOCX export endpoints
    │   ├── mfa.py (16KB)                 # MFA setup & verification
    │   ├── consent.py (15KB)             # Consent management
    │   ├── session_security.py (12KB)    # Session security policies
    │   ├── emergency.py (16KB)           # Emergency access endpoints
    │   ├── access_requests.py (16KB)     # Access request workflows
    │   ├── audit.py (15KB)               # Audit log endpoints
    │   └── cleanup.py (7KB)              # Data cleanup endpoints
    │
    ├── services/                         # Business logic services (20 files)
    │   ├── __init__.py
    │   ├── transcription.py              # Whisper transcription service
    │   ├── note_extraction.py            # AI note extraction (GPT-4o)
    │   ├── template_service.py           # Template CRUD operations
    │   ├── template_seeder.py            # Template seeding
    │   ├── template_autofill.py          # Template auto-population
    │   ├── export_service.py             # Export coordination
    │   ├── pdf_generator.py              # PDF generation (WeasyPrint)
    │   ├── docx_generator.py             # DOCX generation (python-docx)
    │   ├── treatment_plan_service.py     # Treatment plan logic
    │   ├── assessment_service.py         # Assessment scoring
    │   ├── analytics.py                  # Analytics aggregation
    │   ├── dashboard_service.py          # Dashboard data retrieval
    │   ├── timeline.py                   # Timeline event generation
    │   ├── tracking_service.py           # Goal tracking logic
    │   ├── milestone_detector.py         # Milestone achievement detection
    │   ├── trend_calculator.py           # Trend analysis
    │   ├── cleanup.py                    # Data cleanup service
    │   └── (20 services total)
    │
    ├── schemas/                          # Request/response schemas (11 files)
    │   ├── __init__.py
    │   ├── session_schemas.py
    │   ├── tracking_schemas.py
    │   ├── report_schemas.py
    │   ├── export_schemas.py
    │   ├── mfa_schemas.py
    │   ├── consent_schemas.py
    │   ├── audit_schemas.py
    │   ├── assessment_schemas.py
    │   ├── emergency_schemas.py
    │   └── access_request_schemas.py
    │
    ├── tasks/                            # Background job tasks
    │   ├── __init__.py
    │   ├── aggregation.py                # Analytics aggregation jobs
    │   └── scheduled_exports.py          # Scheduled export generation
    │
    ├── templates/                        # Jinja2 templates
    │   └── exports/                      # Export templates
    │
    └── data/                             # Initialization data
        └── __init__.py

TESTS DIRECTORY (/backend/tests):
├── conftest.py                           # Pytest fixtures
├── fixtures/
│   ├── audio/                            # Test audio files
│   ├── conftest.py
│   ├── FIXTURES_QUICK_REFERENCE.md
│   ├── FIXTURES_GUIDE.md
│   └── FIXTURES_SUMMARY.md
│
├── auth/                                 # Auth tests
│   ├── test_auth_integration.py
│   ├── test_auth_rbac.py
│   └── test_e2e_auth_flow.py
│
├── database/                             # Database tests
│   ├── test_*.py
│   └── TEST_DATABASE_CONFIG.md
│
├── routers/                              # Endpoint tests (30+ files)
│   ├── test_sessions.py
│   ├── test_notes_crud.py
│   ├── test_templates.py
│   ├── test_goals.py
│   ├── test_goal_tracking.py
│   ├── test_treatment_plans.py
│   ├── test_analytics.py
│   ├── test_patients.py
│   └── (30 router test files total)
│
├── services/                             # Service tests
│   ├── test_extraction_service.py
│   └── test_*.py
│
├── security/                             # Security tests
├── middleware/                           # Middleware tests
├── performance/                          # Performance tests
│   └── performance_comparison.py
│
├── utils/
├── scripts/
├── mocks/                                # Mock data & services
├── e2e/                                  # End-to-end tests
└── results/                              # Test results & reports

DEPENDENCIES (requirements.txt - 80+ packages):
- FastAPI 0.109.0
- Uvicorn 0.27.0
- SQLAlchemy 2.0.25+
- AsyncPG 0.29.0 (PostgreSQL async)
- Alembic 1.13.1 (migrations)
- OpenAI 1.59.5+ (GPT-4o API)
- Pydantic 2.0+
- PyJWT 3.3.0+ (JWT)
- Passlib 1.7.4 (password hashing)
- BCrypt 4.x (hashing backend)
- PyOTP 2.9.0 (TOTP/MFA)
- QRCode 7.4.2 (MFA QR codes)
- Freezegun 1.5.1 (time mocking for tests)
- PyDub 0.25.1 (audio processing)
- WeasyPrint 60.1 (PDF generation)
- Python-DOCX 1.1.0 (DOCX generation)
- Jinja2 3.1.2 (templating)
- Pytest 7.4.4 (testing)
- Pytest-AsyncIO 0.23.3 (async testing)
- HTTPX 0.26.0 (async HTTP client for tests)
- SlowAPI 0.1.9 (rate limiting)
- APScheduler 3.10.4 (background jobs)
- Faker 20.0.0 (test data)

DATABASE MIGRATIONS CHAIN:
1. 42ef48f739a4 - Authentication schema
2. 7cce0565853d - Auth tables creation
3. 808b6192c57c - Auth schema + missing columns
4. 4da5acd78939 - Treatment plan tables
5. b2c3d4e5f6g7 - Missing user columns & junction (Feature 1 - LATEST)
6. c3d4e5f6g7h8 - Analytics tables
7. d4e5f6g7h8i9 - Timeline events table
8. d5e6f7g8h9i0 - Treatment goals table
9. e4f5g6h7i8j9 - Export tables
10. e5f6g7h8i9j0 - Goal tracking tables
11. f6g7h8i9j0k1 - Note template tables
12. g7h8i9j0k1l2 - Security compliance tables
13. h8i9j0k1l2m3 - Missing Feature 6 indexes
14. i9j0k1l2m3n4 - Notification read field

FEATURES IMPLEMENTED:
✅ Feature 1: Authentication & Authorization (100%)
✅ Feature 2: Session Management (100%)
✅ Feature 3: Goal Tracking (100%)
✅ Feature 4: Treatment Plans (100%)
✅ Feature 5: Note Templates (100%)
✅ Feature 6: Analytics & Dashboards (100%)
✅ Feature 7: Export to PDF/DOCX (100%)
✅ Feature 8: HIPAA Compliance & Security (100%)

================================================================================
2. FRONTEND PROJECT (/frontend)
================================================================================

PROJECT TYPE: Next.js 16 + React 19 + TypeScript + Tailwind CSS
NODE VERSION: Latest stable
PACKAGE MANAGER: npm
BUILD TOOL: Next.js built-in
STYLING: Tailwind CSS 4.0+
UI COMPONENTS: Custom component library
STATE MANAGEMENT: React Context + SWR (hooks)
TESTING: React Testing Library (optional)

ROOT FILES:
├── package.json                          # 30+ npm dependencies
├── tsconfig.json                         # TypeScript configuration
├── .env.local                            # Local environment
├── .env.local.example                    # Environment template
├── .gitignore                            # Frontend-specific ignore rules
├── .next/                                # Next.js build output
│
└── app/                                  # Next.js App Router (14 pages)
    ├── layout.tsx                        # Root layout with providers
    ├── page.tsx                          # Home/index page
    │
    ├── auth/                             # Authentication pages
    │   ├── login/page.tsx                # Login page
    │   └── signup/page.tsx               # Signup page
    │
    ├── therapist/                        # Therapist dashboard
    │   ├── layout.tsx                    # Therapist layout wrapper
    │   ├── page.tsx                      # Therapist dashboard (patient list)
    │   ├── patients/[id]/page.tsx        # Patient detail page
    │   └── sessions/[id]/page.tsx        # Session detail page with transcript
    │
    └── patient/                          # Patient dashboard
        ├── layout.tsx                    # Patient layout wrapper
        └── page.tsx                      # Patient dashboard (session list)

COMPONENTS DIRECTORY (/frontend/components) - 55 files:
├── ui/                                   # Base UI component library (16 components)
│   ├── button.tsx
│   ├── card.tsx
│   ├── input.tsx
│   ├── textarea.tsx
│   ├── badge.tsx
│   ├── checkbox.tsx
│   ├── select.tsx
│   ├── dialog.tsx
│   ├── confirmation-dialog.tsx           # Custom confirmation modal
│   ├── error-message.tsx                 # Error display component
│   ├── form-field.tsx                    # Form wrapper with validation
│   ├── progress-bar.tsx                  # Progress indicator
│   ├── pagination.tsx                    # Pagination controls
│   ├── step-indicator.tsx                # Multi-step indicator
│   ├── skeleton.tsx                      # Loading placeholder
│   └── theme-toggle.tsx                  # Dark/light mode toggle
│
├── auth/                                 # Authentication components (2 files)
│   ├── ProtectedRoute.tsx                # Route protection wrapper
│   └── LogoutButton.tsx                  # Logout button component
│
├── session/                              # Session-related components (8 files)
│   ├── UploadModal.tsx                   # Audio file upload interface
│   ├── NoteWritingModal.tsx              # Session note editor
│   ├── SessionActionBar.tsx              # Session action controls
│   ├── SessionNoteCard.tsx               # Note display card
│   ├── SessionSearchInput.tsx            # Session search/filter
│   ├── TemplateSelector.tsx              # Template selection UI
│   ├── TemplateEditor.tsx                # Template editing interface
│   └── SessionUploader variants (3):
│       ├── SessionUploader.tsx           # Basic uploader
│       ├── SessionUploaderOptimistic.tsx # Optimistic update version
│       └── SessionUploaderWithProgress.tsx # Progress tracking version
│
├── session/ (continued - data display)
│   ├── SessionProgressTracker.tsx        # Progress visualization
│   └── TranscriptViewer.tsx              # Transcript display
│
├── Dashboard components (6 files)
│   ├── SessionCard.tsx                   # Session summary card
│   ├── SessionFilters.tsx                # Session filter interface
│   ├── SessionStatusBadge.tsx            # Status indicator badge
│   ├── SessionSortControl.tsx            # Sorting controls
│   ├── PatientSortControl.tsx            # Patient sorting controls
│   └── ActionItemCard.tsx                # Action item display
│
├── Status & Display components
│   ├── MoodIndicator.tsx                 # Mood/emotion indicator
│   ├── StrategyCard.tsx                  # Strategy display card
│   ├── TriggerCard.tsx                   # Trigger tracking card
│   ├── EmptyState.tsx                    # Empty list UI
│   └── AnimatedPageWrapper.tsx           # Page transition animation
│
├── Skeleton/Loading components
│   ├── skeletons/
│   │   ├── PatientDashboardSkeleton.tsx
│   │   ├── TherapistDashboardSkeleton.tsx
│   │   ├── SessionDetailSkeleton.tsx
│   │   └── index.ts (exports)
│
├── providers/                            # React Context providers (2 files)
│   ├── theme-provider.tsx                # Dark mode provider
│   └── toaster-provider.tsx              # Toast notification provider
│
├── examples/                             # Component demos (2 files)
│   ├── progress-indicator-demo.tsx
│   └── toast-example.tsx
│
└── templates/                            # Template components (2 files)
    ├── TemplateEditor.tsx
    └── TemplateSelector.tsx

HOOKS DIRECTORY (/frontend/hooks) - 16 files:
├── usePatients.ts                        # Fetch patients list
├── useSession.ts                         # Fetch single session data
├── useSessions.ts                        # Fetch sessions list
├── useSessionNotes.ts                    # Fetch session notes
├── useTemplates.ts                       # Fetch note templates
│
├── useSessionSort.ts                     # Session sorting logic
├── usePatientSort.ts                     # Patient sorting logic
├── useSessionFilters.ts                  # Session filtering logic
├── useSessionSearch.ts                   # Session search logic
├── usePagination.ts                      # Pagination state management
│
├── useOptimisticSession.ts               # Optimistic update for single session
├── useOptimisticSessions.ts              # Optimistic updates for session list
├── useOptimisticUpload.ts                # Optimistic upload handling
│
├── use-confirmation.ts                   # Confirmation dialog logic
├── use-delete-session.ts                 # Delete session handler
├── use-logout.ts                         # Logout handler
└── (16 hooks total)

LIB DIRECTORY (/frontend/lib) - 21 files:
├── types.ts                              # TypeScript type definitions
│   ├── PatientId, SessionId, UserId (branded types)
│   ├── Helpers: createPatientId(), createSessionId(), createUserId()
│   ├── Type guards: isPatientId(), isSessionId(), isUserId()
│   └── Schema types: User, Patient, Session, SessionNote, etc.
│
├── schemas.ts                            # Zod validation schemas
├── validation.ts                         # Form validation utilities
│
├── api-client.ts                         # HTTP client wrapper
├── api.ts                                # API endpoint definitions
├── api-types.ts                          # API response types
├── api-config.ts                         # API configuration
├── api-usage-examples.ts                 # API usage examples
│
├── auth-context.tsx                      # Authentication context provider
├── error-context.tsx                     # Error context for global errors
│
├── utils.ts                              # Utility functions
├── type-utils.ts                         # Type utility functions
├── exhaustive.ts                         # Exhaustive checking utilities
├── exhaustive.examples.ts                # Exhaustive checking examples
│
├── animations.ts                         # Animation utilities
├── async-states.ts                       # Async state management
├── token-storage.ts                      # JWT token persistence
├── swr-wrapper.ts                        # SWR data fetching wrapper
├── error-formatter.ts                    # Error message formatting
├── branded-id-examples.ts                # Brand ID usage examples
└── optimistic-test-utils.ts              # Testing utilities

CONFIGURATION FILES:
├── package.json                          # 30+ dependencies
│   ├── next 16.0+
│   ├── react 19.0+
│   ├── typescript 5.x
│   ├── tailwindcss 4.0+
│   ├── lucide-react (icons)
│   ├── swr (data fetching)
│   ├── axios (HTTP)
│   ├── zod (validation)
│   └── (30+ total)
│
├── tsconfig.json                         # TypeScript compiler options
├── .env.local                            # Development environment
└── .env.local.example                    # Environment template

STYLING SYSTEM:
- Tailwind CSS 4.0+ (utility-first)
- Custom component library with consistent design
- Dark mode support (class-based)
- Responsive design (mobile-first)
- Color scheme: Blue/indigo primary, with status colors (green/red/yellow)

FEATURES:
✅ Therapist Dashboard (patient list, quick actions)
✅ Patient Detail View (sessions, medical history)
✅ Session Detail View (transcript viewer, notes)
✅ Audio Upload Modal (with progress tracking)
✅ Note Editor (template-based)
✅ Session Filtering (status, date range)
✅ Session Sorting (date, patient name, status)
✅ Pagination (for large lists)
✅ Dark Mode Support
✅ Error Boundaries
✅ Optimistic Updates (instant UI feedback)
✅ Real-time Progress Tracking
✅ Confirmation Dialogs
✅ Form Validation
✅ Empty States
✅ Mobile Responsive

API INTEGRATION:
- Real mode (NEXT_PUBLIC_USE_REAL_API=true): Connects to backend API
- Mock mode (development): Uses in-memory mock data
- SWR for data fetching with cache invalidation
- Error handling with retry logic
- Authentication via JWT tokens

================================================================================
3. AUDIO TRANSCRIPTION PIPELINE (/audio-transcription-pipeline)
================================================================================

PROJECT TYPE: Python audio processing pipeline
PYTHON VERSION: 3.10+
GPU PROVIDERS: Vast.ai (not Google Colab or other providers)
DEPLOYMENT: Standalone scripts for CPU & GPU

ROOT FILES:
├── requirements.txt
├── requirements_gpu.txt                  # GPU-specific dependencies
├── .env
├── .env.example
├── .gitignore
├── .python-version
├── README.md (7.6KB)
│
├── ARCHITECTURE_CONSOLIDATION_DESIGN.md (68KB)
├── ARCHITECTURE_DIAGRAMS.md (54KB)
├── CONSOLIDATION_SUMMARY.md
├── GPU_PROVIDER_SETUP_GUIDE.md
│
├── venv/                                 # Virtual environment
└── Vast.ai configuration files

SCRIPTS (/audio-transcription-pipeline):
├── download_youtube_audio.py             # YouTube audio downloader
├── download_youtube_sessions.sh           # Batch YouTube download
├── process_youtube_vast.sh                # Vast.ai GPU processing
├── run_complete_pipeline.sh               # End-to-end pipeline
├── run_gpu_pipeline.sh                    # GPU-only pipeline
├── test_colab_gpu.py                      # GPU testing
├── process_colab.py
├── transcribe_gpu.py                      # GPU transcription
├── run_gpu_parallel.sh                    # Parallel GPU jobs
├── apply_improved_alignment.py            # Alignment improvements
├── process_and_format.py                  # Output formatting
├── improved_alignment.py
└── (12+ scripts total)

SOURCE CODE (/audio-transcription-pipeline/src):
├── pipeline.py                           # CPU/API pipeline
├── pipeline_gpu.py                       # GPU-optimized pipeline
├── pipeline_colab.py                     # Google Colab variant
├── pipeline_enhanced.py                  # Enhanced version with features
├── gpu_config.py                         # GPU configuration
├── gpu_audio_ops.py                      # GPU audio operations
├── performance_logger.py                 # Performance monitoring
├── youtube_downloader.py                 # YouTube integration
├── youtube_to_transcript.py              # YouTube to transcript
└── (9 source files)

TESTS (/audio-transcription-pipeline/tests):
├── test_full_pipeline.py                 # End-to-end pipeline test
├── test_audio_ops.py
├── test_transcription.py
├── test_diarization.py                   # Speaker diarization tests
├── conftest.py
├── samples/                              # Test audio samples
├── outputs/                              # Test outputs (JSON)
├── processed/                            # Processed test data
└── (test suite)

OUTPUTS:
├── outputs/                              # Pipeline outputs
│   ├── performance_logs/                 # Performance metrics (JSON)
│   │   └── tests/                        # Test performance logs
│   └── youtube_sessions/                 # YouTube processing results
│
├── downloads/                            # Downloaded media
│   ├── audio/                            # Downloaded audio files
│   └── metadata/                         # Metadata (JSON)
│
└── examples/                             # Example files

PIPELINE FEATURES:
✅ Audio preprocessing (normalization, resampling)
✅ Whisper transcription (API & local GPU)
✅ Speaker diarization (pyannote 3.1)
✅ Therapist/Client role labeling
✅ YouTube audio extraction
✅ GPU acceleration via Vast.ai
✅ Performance monitoring
✅ JSON output formatting
✅ Parallel processing

DEPENDENCIES:
- openai (Whisper API)
- torch (PyTorch for GPU)
- torchvision
- torchaudio
- pyannote.audio (speaker diarization)
- pydub (audio processing)
- requests (HTTP)
- python-dotenv
- pytest

================================================================================
4. SCRAPPING PROJECT (/Scrapping)
================================================================================

PROJECT TYPE: Web scraper for therapy resources
PYTHON VERSION: 3.11+
TARGET: Upheal.com & therapy resource sites
ASYNC: Yes (httpx, playwright)

ROOT FILES:
├── requirements.txt
├── .env
├── .env.example
├── .gitignore
├── .python-version
├── pytest.ini
├── README.md (4.7KB)
├── COMPLIANCE_CHECKLIST.md
├── venv/
└── (configuration)

SOURCE CODE (/Scrapping/src/scraper):
├── __init__.py
├── config.py                             # Scraper configuration
│
├── models/
│   ├── __init__.py
│   └── schemas.py                        # Pydantic data models
│
├── scrapers/
│   ├── __init__.py
│   ├── base.py                           # Base scraper class
│   └── upheal_scraper.py                 # Upheal.com specific scraper
│
└── utils/
    ├── __init__.py
    ├── http_client.py                    # HTTP client wrapper
    ├── logger.py                         # Logging utilities
    ├── rate_limiter.py                   # Rate limiting
    └── storage.py                        # Data persistence

TESTS (/Scrapping/tests):
├── __init__.py
├── conftest.py
├── mocks/                                # Mock data & responses
├── test_upheal_scraper.py                # Upheal scraper tests
├── test_integration.py                   # Integration tests
└── (test suite)

DATA (/Scrapping/data):
├── raw/                                  # Raw scraped data
├── processed/                            # Processed data
└── (storage directories)

LOGS (/Scrapping/logs):
└── (scraper logs)

FEATURES:
✅ Upheal.com resource scraping
✅ Async HTTP client with rate limiting
✅ Pydantic data validation
✅ Structured logging
✅ Data persistence
✅ Error recovery
✅ Compliance checking

================================================================================
5. CLAUDE CONFIGURATION (.claude/)
================================================================================

CLAUDE.MD - Project Rules & Organization:
├── Monorepo structure documentation
├── Critical git-first workflow
├── Organization principles
├── Architecture overview
├── Project status & roadmap
├── Session logs
└── (459 lines)

ORCHESTRATION SYSTEM:
├── ORCHESTRATION_SYSTEM_INDEX.md         # Main index
├── DYNAMIC_WAVE_ORCHESTRATION.md         # Wave-based execution methodology
├── META_ORCHESTRATION.md                 # Child orchestrator system
├── ORCHESTRATION_RECURSION_SAFETY.md     # Safety guardrails
├── ORCHESTRATION_IMPROVEMENTS.md         # Enhancement docs
└── AUTOMATIC_RECURSION_SUMMARY.md        # Recursion tracking

AGENTS (/agents/cl/):
├── parallel-orchestrator.md              # Main orchestrator agent
├── codebase-analyzer.md                  # Code analysis agent
├── codebase-locator.md                   # File finding agent
├── codebase-pattern-finder.md            # Pattern detection agent
├── web-search-researcher.md              # Web research agent
└── README.md                             # Agent documentation

COMMANDS (/commands/cl/):
├── orchestrate.md                        # Orchestration command
├── commit.md                             # Git commit command
├── iterate_plan.md                       # Plan iteration
├── describe_pr.md                        # PR generation
├── create_plan.md                        # Plan creation
├── implement_plan.md                     # Plan execution
└── research_codebase.md                  # Codebase research

================================================================================
6. LEGACY PROJECT (/therabridge-backend)
================================================================================

PROJECT TYPE: Alternative backend with prompt system
STATUS: Legacy/not actively used

CONTENTS:
├── prompt-system/                        # Prompt templates
└── prompts/                              # Prompt definitions

================================================================================
INTEGRATION POINTS BETWEEN BACKEND & FRONTEND
================================================================================

API COMMUNICATION:
Base URL: Determined by NEXT_PUBLIC_API_URL (frontend env var)
Backend runs on: http://localhost:8000 (default)
Frontend runs on: http://localhost:3000 (default)

AUTHENTICATION FLOW:
1. User signs up/logs in via Frontend (/auth/signup or /auth/login)
2. Frontend POST to Backend /auth/signup or /auth/login
3. Backend returns JWT token + user info
4. Frontend stores JWT in localStorage (token-storage.ts)
5. Frontend includes JWT in Authorization header for all requests
6. Backend validates JWT via auth middleware

SESSION DATA FLOW:
1. Therapist uploads session audio (UploadModal.tsx)
2. Frontend POST to /sessions/upload with file
3. Backend processes audio through transcription pipeline
4. Backend extracts notes using AI service
5. Frontend polls /sessions/:id/status for processing status
6. Frontend displays results when ready

DATA MODELS CORRESPONDENCE:
Backend Pydantic Schemas ↔ Frontend TypeScript Types
- UserCreate/UserResponse ↔ User type
- SessionCreate/SessionResponse ↔ Session type
- SessionNoteCreate/SessionNoteResponse ↔ SessionNote type
- GoalCreate/GoalResponse ↔ Goal type
- TreatmentPlanCreate/TreatmentPlanResponse ↔ TreatmentPlan type
- ProgressReport schema ↔ ProgressReport type
- ExportRequest/ExportResponse ↔ ExportRequest/ExportResponse types

API ENDPOINTS USED BY FRONTEND:
Authentication:
- POST /auth/signup
- POST /auth/login
- POST /auth/refresh (token refresh)
- POST /auth/logout

Patients:
- GET /patients (list)
- GET /patients/:id (detail)
- GET /therapist/patients (therapist's patients)

Sessions:
- GET /sessions (list)
- GET /sessions/:id (detail)
- POST /sessions (create)
- POST /sessions/:id/upload (upload audio)
- GET /sessions/:id/status (processing status)
- GET /sessions/:id/transcript (transcript retrieval)
- POST /sessions/:id/notes (extract notes)

Notes:
- GET /sessions/:id/notes (list)
- POST /notes (create)
- PUT /notes/:id (update)
- DELETE /notes/:id (delete)

Templates:
- GET /templates (list)
- GET /templates/:id (detail)
- POST /templates (create)
- PUT /templates/:id (update)

Goals:
- GET /goals (list)
- POST /goals (create)
- PUT /goals/:id (update)

Progress:
- GET /analytics/dashboard
- GET /progress-reports

================================================================================
KEY FILES BY PURPOSE
================================================================================

AUTHENTICATION & SECURITY:
Backend:
- /backend/app/auth/router.py             # Auth endpoints
- /backend/app/auth/schemas.py            # Auth schemas
- /backend/app/auth/dependencies.py       # JWT validation
- /backend/app/security/mfa.py            # TOTP implementation
- /backend/app/security/encryption.py     # Field encryption
- /backend/app/middleware/security_headers.py  # HIPAA headers

Frontend:
- /frontend/lib/auth-context.tsx          # Auth context
- /frontend/lib/token-storage.ts          # JWT storage
- /frontend/components/auth/ProtectedRoute.tsx # Route protection

SESSION MANAGEMENT:
Backend:
- /backend/app/routers/sessions.py        # Session endpoints (1246 LOC)
- /backend/app/models/db_models.py        # Session ORM model
- /backend/app/services/transcription.py  # Transcription service
- /backend/app/services/note_extraction.py # AI note extraction

Frontend:
- /frontend/app/therapist/sessions/[id]/page.tsx  # Session detail
- /frontend/components/session/UploadModal.tsx    # Upload interface
- /frontend/components/session/TranscriptViewer.tsx

GOAL TRACKING:
Backend:
- /backend/app/routers/goal_tracking.py   # Goal tracking endpoints (30KB)
- /backend/app/models/tracking_models.py  # Goal models
- /backend/app/services/milestone_detector.py
- /backend/app/services/trend_calculator.py

Frontend:
- /frontend/hooks/useOptimisticSession.ts # Optimistic updates
- /frontend/components/SessionProgressTracker.tsx

DATA EXPORT:
Backend:
- /backend/app/routers/export.py          # Export endpoints (22KB)
- /backend/app/services/pdf_generator.py  # PDF generation
- /backend/app/services/docx_generator.py # DOCX generation

Frontend:
- /frontend/components/session/SessionActionBar.tsx  # Export button

ANALYTICS:
Backend:
- /backend/app/routers/analytics.py       # Analytics endpoints
- /backend/app/services/analytics.py      # Analytics logic
- /backend/app/services/dashboard_service.py

Frontend:
- /frontend/app/therapist/page.tsx        # Dashboard display

================================================================================
TESTING STRATEGY
================================================================================

BACKEND TESTING (/backend/tests):
- Unit tests for services
- Integration tests for endpoints
- E2E tests for auth flows
- Performance tests
- Fixtures: conftest.py with database session management
- Coverage: pytest-cov
- 30+ router test files
- Mock OpenAI & external services

FRONTEND TESTING:
- Component testing with React Testing Library (optional)
- Integration tests for API calls
- Type checking with TypeScript
- ESLint for code quality

AUDIO PIPELINE TESTING (/audio-transcription-pipeline/tests):
- Unit tests for pipeline components
- Integration tests for full pipeline
- Performance benchmarks
- JSON output validation

================================================================================
FILE COUNT SUMMARY
================================================================================

Backend:
- Python source files: 80+ (.py files)
- Test files: 50+
- Migrations: 16
- Total Python files: 150+

Frontend:
- TypeScript/TSX files: 70+
- Component files: 55
- Hook files: 16
- Lib files: 21
- Pages: 10
- Config files: 5+
- Total TypeScript files: 80+

Audio Pipeline:
- Python files: 20+
- Scripts: 12+
- Tests: 10+

Scrapping:
- Python files: 15+
- Tests: 5+

Documentation:
- Root level: 2 files (README.md, GENERATORS_AND_HOOKS_ANALYSIS.md)
- Backend: 5+ files (README.md, SECURITY.md, etc)
- Frontend: 40+ documentation files
- Project MDs: 1 master file (TherapyBridge.md)
- Audio Pipeline: 4+ architecture docs
- .claude: 20+ configuration files

TOTAL PROJECT SIZE: 400+ source files + 400+ documentation files

================================================================================
MODULE ORGANIZATION & PATTERNS
================================================================================

BACKEND ARCHITECTURE:
- Router-based organization (one router per resource)
- Service layer for business logic
- Models layer for database ORM
- Schemas layer for request/response validation
- Middleware for cross-cutting concerns
- Security layer for authentication & authorization
- Async/await throughout

FRONTEND ARCHITECTURE:
- Next.js App Router (file-based routing)
- Component composition (small, reusable components)
- Custom hooks for state & data fetching
- Context for global state (auth, errors)
- Type-safe branded IDs (PatientId, SessionId, UserId)
- Zod schemas for runtime validation
- SWR for data fetching with cache

NAMING CONVENTIONS:
Backend:
- Models: UpperCase (User, Session, Goal)
- Routes: lowercase (sessions.py, goals.py)
- Services: UpperCase + Service (NoteExtractionService)
- Schemas: UpperCase + suffix (UserCreate, SessionResponse)

Frontend:
- Components: PascalCase (SessionCard, UploadModal)
- Hooks: camelCase starting with 'use' (useSession, usePagination)
- Types: UpperCase (User, Session, Goal)
- Utilities: camelCase (formatDate, validateEmail)
- Files: kebab-case or PascalCase depending on type

================================================================================
DEPLOYMENT CONFIGURATION
================================================================================

BACKEND DEPLOYMENT OPTIONS:
1. Docker Alpine: Lightweight production container
2. Docker Lambda: AWS Lambda deployment
3. Docker Ubuntu: Standard Linux deployment
4. Environment: .env configuration
5. Database: PostgreSQL on Neon
6. Async: AsyncPG for database

FRONTEND DEPLOYMENT OPTIONS:
1. Vercel (recommended for Next.js)
2. Docker container
3. Static export for CDN
4. Environment: .env.local configuration
5. Build: npm run build

AUDIO PIPELINE DEPLOYMENT:
1. Vast.ai for GPU workloads
2. Standalone script execution
3. Docker containerization
4. Environment: .env configuration

================================================================================
CURRENT DEVELOPMENT STATUS (as of Dec 18, 2025)
================================================================================

COMPLETED:
✅ Backend authentication with JWT & MFA
✅ Database schema (16 migrations, all applied)
✅ Session management with transcription
✅ Goal tracking with milestones
✅ Treatment plans & interventions
✅ Note templates & AI extraction
✅ Export to PDF/DOCX
✅ Analytics & dashboards
✅ HIPAA compliance & security
✅ Frontend basic pages & components
✅ Frontend API integration layer
✅ Frontend dark mode support
✅ Frontend optimistic updates
✅ Audio transcription pipeline
✅ Web scraper framework

IN PROGRESS:
- Frontend integration with live backend (toggle available)
- Mobile responsiveness refinement

NEXT STEPS:
- [ ] Test frontend with live backend
- [ ] Fix remaining ESLint errors
- [ ] Deploy backend to AWS Lambda
- [ ] Implement additional analytics features
- [ ] Test Vast.ai GPU pipeline at scale
- [ ] Load testing & performance optimization

================================================================================
ADDITIONAL NOTES
================================================================================

CRITICAL WORKFLOWS:
1. Adding new backend endpoint:
   - Create route in appropriate router file
   - Define Pydantic schema in schemas/
   - Implement service logic
   - Add tests
   - Create migration if DB changes

2. Adding new frontend page:
   - Create .tsx file in app/ directory
   - Import necessary components & hooks
   - Use branded IDs for type safety
   - Add TypeScript types
   - Integrate with API layer

3. Database changes:
   - Use alembic: alembic revision --autogenerate -m "description"
   - Review generated migration
   - Apply: alembic upgrade head
   - Update ORM models if needed

GIT WORKFLOW:
- Feature branches from main
- Commit before major changes (backup workflow)
- PR reviews before merging to main
- Merge commits for tracking

PERFORMANCE CONSIDERATIONS:
- Backend: AsyncPG for fast database queries
- Frontend: SWR caching, optimistic updates
- Audio: GPU acceleration via Vast.ai
- Exports: Async job scheduling

SECURITY HIGHLIGHTS:
- JWT authentication with secure storage
- MFA (TOTP) support
- Field-level encryption
- Rate limiting
- Audit logging
- CORS configuration
- HIPAA-compliant headers
- Emergency access workflows


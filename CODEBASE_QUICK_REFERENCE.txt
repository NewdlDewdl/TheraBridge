THERAPYBRIDGE CODEBASE - QUICK REFERENCE
==========================================

Generated: 2025-12-18
Full Map: COMPLETE_CODEBASE_MAP.txt (1129 lines)

================================================================================
PROJECT AT A GLANCE
================================================================================

Monorepo Structure:
- backend/                  FastAPI + PostgreSQL API
- frontend/                Next.js + React dashboard
- audio-transcription-pipeline/  Audio processing
- Scrapping/               Web scraper
- therabridge-backend/     Legacy prompt system

Total Source Files: 400+
Total Documentation: 400+ files

================================================================================
BACKEND QUICK FACTS
================================================================================

Location: /backend
Language: Python 3.13
Framework: FastAPI + SQLAlchemy
Database: PostgreSQL (Neon)
Features: 8 major features (Auth, Goals, Treatment, Export, etc.)

Key Numbers:
- Routers: 21 endpoint files
- Services: 20 business logic files
- Models: 10 model files
- Tests: 50+ test files
- Migrations: 16 database migrations (chain)
- Dependencies: 80+ packages

File Locations:

Auth & Security:
  /backend/app/auth/               ← Authentication endpoints
  /backend/app/security/           ← MFA, encryption, emergency access
  /backend/app/middleware/         ← Request middleware (audit, rate limit, etc)

API Endpoints:
  /backend/app/routers/sessions.py          ← 1246 LOC, main endpoint
  /backend/app/routers/goal_tracking.py     ← 30KB, goal tracking
  /backend/app/routers/export.py            ← 22KB, PDF/DOCX exports
  /backend/app/routers/treatment_plans.py   ← Treatment management
  /backend/app/routers/mfa.py               ← MFA setup & verification
  /backend/app/routers/analytics.py         ← Dashboard data

Business Logic:
  /backend/app/services/transcription.py         ← Whisper integration
  /backend/app/services/note_extraction.py       ← GPT-4o AI service
  /backend/app/services/pdf_generator.py         ← WeasyPrint
  /backend/app/services/milestone_detector.py    ← Goal milestones
  /backend/app/services/analytics.py             ← Dashboard logic

Database:
  /backend/app/models/db_models.py         ← ORM models (10KB)
  /backend/alembic/versions/               ← 16 migration files

Testing:
  /backend/tests/routers/               ← 30+ endpoint tests
  /backend/tests/auth/                  ← Authentication tests
  /backend/tests/services/              ← Service tests
  /backend/tests/conftest.py            ← Pytest fixtures

Most Important Files:
1. /backend/app/main.py              ← FastAPI app setup
2. /backend/app/routers/sessions.py  ← Session CRUD (largest endpoint)
3. /backend/app/models/db_models.py  ← Database schema
4. /backend/requirements.txt          ← All dependencies
5. /backend/.env.example              ← Configuration template

================================================================================
FRONTEND QUICK FACTS
================================================================================

Location: /frontend
Language: TypeScript + React
Framework: Next.js 16 + React 19
Styling: Tailwind CSS 4.0
Dependencies: 30+ npm packages

Key Numbers:
- Pages: 10 route pages
- Components: 55 component files
- Hooks: 16 custom hooks
- Lib utilities: 21 utility files
- Documentation: 40+ guides
- Total files: 80+ TypeScript/TSX

File Locations:

Pages (Next.js App Router):
  /frontend/app/page.tsx                   ← Home page
  /frontend/app/auth/login/page.tsx        ← Login
  /frontend/app/auth/signup/page.tsx       ← Signup
  /frontend/app/therapist/page.tsx         ← Therapist dashboard
  /frontend/app/therapist/patients/[id]/   ← Patient detail
  /frontend/app/therapist/sessions/[id]/   ← Session detail
  /frontend/app/patient/page.tsx           ← Patient dashboard

Components:
  /frontend/components/ui/                 ← 16 base UI components
  /frontend/components/session/            ← 8 session components
  /frontend/components/skeletons/          ← 3 loading skeletons
  /frontend/components/auth/               ← Auth wrapper components
  /frontend/components/providers/          ← Context providers (theme, toast)

Hooks:
  /frontend/hooks/useSession.ts            ← Single session fetch
  /frontend/hooks/useSessions.ts           ← Sessions list fetch
  /frontend/hooks/useSessionSort.ts        ← Sorting logic
  /frontend/hooks/useSessionFilters.ts     ← Filtering logic
  /frontend/hooks/useOptimisticSession.ts  ← Optimistic updates

Libraries:
  /frontend/lib/types.ts                   ← TypeScript type definitions + branded IDs
  /frontend/lib/api-client.ts              ← HTTP client
  /frontend/lib/auth-context.tsx           ← Auth state management
  /frontend/lib/schemas.ts                 ← Zod validation

Most Important Files:
1. /frontend/app/layout.tsx          ← Root layout with providers
2. /frontend/lib/types.ts            ← Type definitions
3. /frontend/lib/api-client.ts       ← HTTP communication
4. /frontend/package.json            ← Dependencies
5. /frontend/components/ui/          ← Base components

================================================================================
AUDIO PIPELINE QUICK FACTS
================================================================================

Location: /audio-transcription-pipeline
Language: Python 3.10+
Type: Standalone processing pipeline
GPU Provider: Vast.ai

Key Numbers:
- Source files: 9 Python modules
- Scripts: 12+ shell/Python scripts
- Test files: 10+ tests
- Outputs: JSON format
- Dependencies: 20+ packages

Source Files:
  src/pipeline.py                ← CPU/API pipeline (main entry)
  src/pipeline_gpu.py            ← GPU-optimized version
  src/gpu_audio_ops.py           ← GPU operations
  src/gpu_config.py              ← GPU configuration
  src/performance_logger.py      ← Benchmarking
  src/youtube_downloader.py      ← YouTube extraction

Scripts:
  run_complete_pipeline.sh       ← End-to-end execution
  run_gpu_pipeline.sh            ← GPU-only execution
  transcribe_gpu.py              ← GPU transcription
  download_youtube_audio.py      ← Download manager

Tests:
  tests/test_full_pipeline.py    ← Integration tests
  tests/test_diarization.py      ← Speaker labeling
  tests/test_transcription.py    ← Transcription tests

Features:
✓ Whisper transcription (API or local GPU)
✓ Speaker diarization (pyannote)
✓ Audio preprocessing
✓ YouTube integration
✓ Performance monitoring
✓ GPU acceleration

================================================================================
SCRAPPING PROJECT QUICK FACTS
================================================================================

Location: /Scrapping
Language: Python 3.11+
Target: Upheal.com therapy resources
Type: Web scraper

Key Numbers:
- Source files: 12 Python modules
- Test files: 4 test files
- Scrapers: 1 (Upheal)
- Utils: 4 utility modules

Structure:
  src/scraper/scrapers/upheal_scraper.py  ← Main scraper
  src/scraper/utils/http_client.py        ← HTTP wrapper
  src/scraper/utils/rate_limiter.py       ← Rate limiting
  src/scraper/models/schemas.py           ← Data models

================================================================================
KEY INTEGRATION POINTS
================================================================================

Frontend → Backend:
1. Authentication:
   - Frontend POST /auth/signup or /auth/login
   - Backend returns JWT token
   - Frontend stores in localStorage

2. Session Upload:
   - Frontend POST /sessions/upload with audio file
   - Backend processes through transcription pipeline
   - Frontend polls /sessions/:id/status
   - Frontend displays results

3. Data Retrieval:
   - Frontend GET /sessions, /goals, /templates, etc
   - SWR caching for performance
   - Real/mock API toggle via NEXT_PUBLIC_USE_REAL_API

Backend ← Audio Pipeline:
- Pipeline runs independently
- Outputs JSON to /outputs/
- Backend reads/processes JSON results
- Stores in database

Frontend ← Audio Pipeline:
- No direct integration
- Frontend uses Backend API to access pipeline results

================================================================================
QUICK COMMAND REFERENCE
================================================================================

Backend Setup:
  cd backend
  python -m venv venv
  source venv/bin/activate
  pip install -r requirements.txt
  alembic upgrade head          (run migrations)
  uvicorn app.main:app --reload (start server)

Frontend Setup:
  cd frontend
  npm install
  npm run dev                   (start dev server)
  npm run build                 (production build)

Audio Pipeline:
  cd audio-transcription-pipeline
  python -m venv venv
  source venv/bin/activate
  pip install -r requirements.txt
  python tests/test_full_pipeline.py  (test run)

Testing:
  Backend: pytest (runs all tests)
  Backend: pytest backend/tests/routers/ (endpoint tests)
  Frontend: npm test (if configured)

Environment Variables:
  Backend: Copy .env.example to .env
  Frontend: Copy .env.local.example to .env.local
  Audio: Copy .env.example to .env

Database:
  Run migrations: cd backend && alembic upgrade head
  Create migration: alembic revision --autogenerate -m "description"
  Current version: alembic current

================================================================================
DOCUMENTATION LOCATIONS
================================================================================

Master Docs:
- /Project MDs/TherapyBridge.md       (459 lines, master reference)

Backend Docs:
- /backend/README.md                  (31KB, comprehensive)
- /backend/SECURITY.md                (17KB, HIPAA compliance)
- /backend/DEPLOYMENT_CHECKLIST.md    (deployment guide)

Frontend Docs:
- 40+ documentation files in /frontend/ (guides for specific features)
- DARK_MODE_README.md
- ERROR_HANDLING_GUIDE.md
- FORM_VALIDATION_GUIDE.md
- MOBILE_RESPONSIVENESS_INDEX.md
- IMPLEMENTATION_CHECKLIST.md

Audio Pipeline Docs:
- /audio-transcription-pipeline/README.md
- ARCHITECTURE_CONSOLIDATION_DESIGN.md (68KB)
- ARCHITECTURE_DIAGRAMS.md (54KB)
- GPU_PROVIDER_SETUP_GUIDE.md

Claude Config:
- /.claude/CLAUDE.md                  (project rules)
- /.claude/DYNAMIC_WAVE_ORCHESTRATION.md (orchestration system)

================================================================================
DATABASE SCHEMA OVERVIEW
================================================================================

Core Tables:
- users (authentication, profile)
- therapy_sessions (session records)
- session_notes (extracted notes)
- therapist_patients (many-to-many relationship)

Goals & Tracking:
- goals (patient goals)
- goal_tracking (progress records)
- goal_milestones (achievement markers)

Treatment & Assessment:
- treatment_plans (therapy plans)
- treatment_goals (goals within plans)
- assessments (standardized assessments)
- interventions (therapeutic interventions)

Analytics & Data:
- analytics_aggregation (dashboard data)
- timeline_events (session timeline)
- exports (export records)

Security & Compliance:
- mfa_tokens (TOTP MFA)
- audit_logs (compliance logging)
- consent_records (patient consent)
- emergency_access_logs (emergency protocols)

Note Templates:
- note_templates (template definitions)
- template_sections (template parts)
- template_autofills (AI auto-population)

================================================================================
DEPENDENCIES SUMMARY
================================================================================

Backend - Key Packages:
FastAPI, Uvicorn, SQLAlchemy, AsyncPG, Alembic
OpenAI, Pydantic, PyJWT, Passlib, BCrypt
PyOTP, QRCode, WeasyPrint, Python-DOCX, Jinja2
Pytest, Freezegun, Faker, SlowAPI, APScheduler

Frontend - Key Packages:
Next.js, React, TypeScript, Tailwind CSS
SWR, Axios, Zod, Lucide-react
React Testing Library (optional)

Audio Pipeline - Key Packages:
OpenAI, Torch, Torchvision, Torchaudio
Pyannote.audio, PyDub, Requests, Pytest

================================================================================
CONFIGURATION FILES
================================================================================

Root Level:
- .claude/CLAUDE.md           ← PROJECT RULES (READ THIS FIRST)
- .gitignore
- .python-version
- README.md

Backend:
- requirements.txt            ← Python dependencies
- .env                        ← Configuration (DO NOT COMMIT)
- .env.example               ← Configuration template
- pytest.ini                 ← Test configuration
- alembic.ini                ← Migration configuration
- Dockerfile.alpine/lambda/ubuntu

Frontend:
- package.json               ← npm dependencies
- tsconfig.json              ← TypeScript configuration
- .env.local                 ← Configuration (DO NOT COMMIT)
- .env.local.example         ← Configuration template

Audio:
- requirements.txt           ← Python dependencies
- requirements_gpu.txt       ← GPU-specific packages
- .env                       ← Configuration
- .env.example               ← Configuration template

================================================================================
MOST CRITICAL FILES TO UNDERSTAND
================================================================================

Understanding the Project:
1. /.claude/CLAUDE.md                    ← Project organization rules
2. /Project MDs/TherapyBridge.md         ← Master project docs
3. /COMPLETE_CODEBASE_MAP.txt            ← This detailed map

Backend Foundation:
1. /backend/app/main.py                  ← FastAPI setup
2. /backend/app/models/db_models.py      ← Database schema
3. /backend/requirements.txt              ← All dependencies
4. /backend/README.md                    ← Comprehensive docs

Frontend Foundation:
1. /frontend/app/layout.tsx              ← Root layout
2. /frontend/lib/types.ts                ← Type definitions
3. /frontend/lib/api-client.ts           ← HTTP communication
4. /frontend/package.json                ← Dependencies

Integration Points:
1. /backend/app/routers/sessions.py      ← Main API endpoint
2. /frontend/components/session/UploadModal.tsx ← Frontend upload
3. /frontend/lib/auth-context.tsx        ← Auth management

================================================================================
FEATURE COMPLETENESS
================================================================================

Feature 1: Authentication & Authorization (100%) ✓
- JWT tokens with refresh
- Multi-factor authentication (TOTP)
- Role-based access control
- User verification workflow

Feature 2: Session Management (100%) ✓
- CRUD operations
- Audio upload & processing
- Transcription integration
- Status tracking

Feature 3: Goal Tracking (100%) ✓
- Goal CRUD
- Progress tracking
- Milestone detection
- Trend analysis
- Notifications

Feature 4: Treatment Plans (100%) ✓
- Plan creation & management
- Intervention tracking
- Plan-goal relationships
- Progress monitoring

Feature 5: Note Templates (100%) ✓
- Template management
- Section-based structure
- AI auto-fill capability
- Custom templates

Feature 6: Analytics & Dashboards (100%) ✓
- Session analytics
- Goal tracking analytics
- Progress reports
- Dashboard data aggregation

Feature 7: Export to PDF/DOCX (100%) ✓
- PDF generation (WeasyPrint)
- DOCX generation (python-docx)
- Jinja2 templating
- Scheduled exports

Feature 8: HIPAA Compliance & Security (100%) ✓
- Field-level encryption
- Audit logging
- Emergency access protocols
- Consent tracking
- Security headers

================================================================================
NEXT IMMEDIATE TASKS
================================================================================

Frontend:
- [ ] Test frontend with live backend (toggle NEXT_PUBLIC_USE_REAL_API)
- [ ] Fix remaining ESLint errors
- [ ] Mobile responsiveness refinement
- [ ] Performance optimization

Backend:
- [ ] Deploy to AWS Lambda
- [ ] Load testing
- [ ] Performance monitoring setup

Audio Pipeline:
- [ ] Test Vast.ai GPU pipeline at scale
- [ ] Performance benchmarking
- [ ] Parallel processing optimization

================================================================================
END OF QUICK REFERENCE
================================================================================

For complete details, see: COMPLETE_CODEBASE_MAP.txt
